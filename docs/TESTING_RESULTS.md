# –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è nvim-agent

## ‚úÖ –©–æ –ø—Ä–∞—Ü—é—î

### 1. MCP Tools —Å–∏—Å—Ç–µ–º–∞
- ‚úÖ 28 tools —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —ñ –ø—Ä–∞—Ü—é—é—Ç—å
- ‚úÖ `get_project_structure` —É—Å–ø—ñ—à–Ω–æ —Å–∫–∞–Ω—É—î –ø—Ä–æ–µ–∫—Ç
- ‚úÖ `list_buffers` –ø—Ä–∞—Ü—é—î (–ø—ñ—Å–ª—è —Ñ—ñ–∫—Å—É nvim_buf_get_option)
- ‚úÖ `mcp.handle_tool_calls` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–∏–∫–æ–Ω—É—î tools —ñ –≤–∏–∫–ª–∏–∫–∞—î callback
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ tools –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ñ–æ—Ä–º–∞—Ç—É—é—Ç—å—Å—è

### 2. –°–µ—Å—ñ—ó —Ç–∞ —Ä–µ–∂–∏–º–∏
- ‚úÖ –ú–Ω–æ–∂–∏–Ω–Ω—ñ —á–∞—Ç–∏ –ø—Ä–∞—Ü—é—é—Ç—å
- ‚úÖ Per-session modes (ask/edit/agent)
- ‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è/–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó
- ‚úÖ –°–∏—Å—Ç–µ–º–Ω–∏–π –ø—Ä–æ–º–ø—Ç –º—ñ—Å—Ç–∏—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ MCP tools –≤ Agent —Ä–µ–∂–∏–º—ñ

### 3. API integration
- ‚úÖ API –º–æ–¥—É–ª—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–æ–±–ª—è—î –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ tool_calls –∑ API –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –ø—Ä–∞—Ü—é—î
- ‚úÖ Callback –ª–∞–Ω—Ü—é–∂–æ–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π

## ‚ùå –ó–Ω–∞–π–¥–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞

### Copilot API –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è

**–°–∏–º–ø—Ç–æ–º**: AI "–∑–∞–≤–∏—Å–∞—î" –ø—Ä–∏ —Å–ø—Ä–æ–±—ñ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ tools

**–ü—Ä–∏—á–∏–Ω–∞**: `gh copilot` –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π –¥–ª—è API –∑–∞–ø–∏—Ç—ñ–≤

**–ü–æ–º–∏–ª–∫–∞**:
```
Copilot API request failed with exit code: 1
GitHub Copilot –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ. –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é?
```

**–†—ñ—à–µ–Ω–Ω—è**: 

1. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –æ–¥–∏–Ω —Ä–∞–∑:
   ```bash
   gh copilot suggest "test command"
   ```

2. –ü—Ä–æ–π–¥—ñ—Ç—å —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é (–≤–∏–±–µ—Ä—ñ—Ç—å –æ–ø—Ü—ñ—é 1)

3. –ü—ñ—Å–ª—è —Ü—å–æ–≥–æ nvim-agent –±—É–¥–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏

## üìä –¢–µ—Å—Ç–æ–≤—ñ —Ñ–∞–π–ª–∏

–°—Ç–≤–æ—Ä–µ–Ω–æ 5 —Ç–µ—Å—Ç—ñ–≤:

1. **test_tool_direct.lua** - –ü—Ä—è–º–∏–π –≤–∏–∫–ª–∏–∫ get_project_structure
   - ‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ: tool –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∑–∞ 2-3ms
   - –†–µ–∑—É–ª—å—Ç–∞—Ç: 35 —Ñ–∞–π–ª—ñ–≤, 6 –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ–π

2. **test_tool_calls.lua** - –¢–µ—Å—Ç handle_tool_calls
   - ‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ: callback –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
   - –°–∏–º—É–ª—è—Ü—ñ—è tool_calls –≤—ñ–¥ API –ø—Ä–∞—Ü—é—î

3. **test_api_response.lua** - –¢–µ—Å—Ç –ø–∞—Ä—Å–∏–Ω–≥—É API –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
   - ‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ: –≤—Å—ñ 4 —Å—Ü–µ–Ω–∞—Ä—ñ—ó –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è
   - tool_calls –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–∏—Ç—è–≥—É—é—Ç—å—Å—è –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ

4. **test_agent_context.lua** - –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç—É
   - ‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ: –ø—Ä–æ–º–ø—Ç –º—ñ—Å—Ç–∏—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ tools
   - –ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ 6 –∫–ª—é—á–æ–≤–∏—Ö —Å–ª—ñ–≤

5. **test_integration_full.lua** - –ü–æ–≤–Ω–∏–π —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω–∏–π —Ç–µ—Å—Ç
   - ‚úÖ –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞: –≤—Å—ñ 7 –∫—Ä–æ–∫—ñ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ
   - ‚ùå API: –≤–∏—è–≤–ª–µ–Ω–æ –ø—Ä–æ–±–ª–µ–º—É –∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—î—é

## üîß –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

### 1. list_buffers - nvim API compatibility
```lua
-- –ë—É–ª–æ:
local modified = vim.api.nvim_buf_get_option(buf, 'modified')

-- –°—Ç–∞–ª–æ (–∑ fallback):
local ok, modified = pcall(function()
    return vim.api.nvim_get_option_value('modified', {buf = buf})
end)
if not ok then
    ok, modified = pcall(vim.api.nvim_buf_get_option, buf, 'modified')
end
```

### 2. get_project_structure - performance
- –î–æ–¥–∞–Ω–æ max_files –ª—ñ–º—ñ—Ç (500)
- –ó–º–µ–Ω—à–µ–Ω–æ max_depth –∑ 5 –¥–æ 3
- –î–æ–¥–∞–Ω–æ pcall –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è
- –î–æ–¥–∞–Ω–æ max_iterations (1000) –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–∏—Ö —Ü–∏–∫–ª—ñ–≤

### 3. –°–∏—Å—Ç–µ–º–Ω–∏–π –ø—Ä–æ–º–ø—Ç –¥–ª—è Agent
–û–Ω–æ–≤–ª–µ–Ω–æ `modes.lua` - –¥–æ–¥–∞–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å MCP tools:
- üìÅ –†–æ–±–æ—Ç–∞ –∑ —Ñ–∞–π–ª–∞–º–∏ (read_file, write_file, find_files, open_file)
- üîç –ü–æ—à—É–∫ (grep_search, get_project_structure, get_diagnostics)
- üíª –í–∏–∫–æ–Ω–∞–Ω–Ω—è (execute_shell, execute_command, format_code)
- üîß –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è (insert_text, delete_lines, replace_text)

### 4. UI –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è (—è–∫ VS Code)
- –ö–æ–º–ø–∞–∫—Ç–Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è tools ("üîß –ê–Ω–∞–ª—ñ–∑—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç—É...")
- –ù—É–º–µ—Ä–æ–≤–∞–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –¥–ª—è –º–Ω–æ–∂–∏–Ω–Ω–∏—Ö tools
- –ü—Ä–∏–±—Ä–∞–Ω–æ –∑–∞–π–≤–µ "üß† –ê–Ω–∞–ª—ñ–∑—É—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏..."

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

### –î–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:
1. –ü–µ—Ä–µ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º Agent —Ä–µ–∂–∏–º—É –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –≤ gh copilot
2. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –∫–æ–º–∞–Ω–¥–∏: "–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π get_project_structure"
3. Agent —Ä–µ–∂–∏–º –Ω–∞–π–∫—Ä–∞—â–∏–π –¥–ª—è –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ–µ–∫—Ç—É

### –î–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏:
1. –í—Å—ñ –Ω–æ–≤—ñ features –ø–æ–∫—Ä–∏–≤–∞—Ç–∏ —Ç–µ—Å—Ç–∞–º–∏
2. –¢–µ—Å—Ç–∏ –º–∞—é—Ç—å –±—É—Ç–∏ —à–≤–∏–¥–∫–∏–º–∏ (< 1 —Å–µ–∫) —ñ –Ω–µ–∑–∞–ª–µ–∂–Ω–∏–º–∏
3. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ mock –¥–ª—è API —Ç–µ—Å—Ç—ñ–≤
4. DEBUG print –∫–æ—Ä–∏—Å–Ω—ñ –¥–ª—è troubleshooting

## üéØ –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏

1. [ ] –î–æ–¥–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É gh copilot auth –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É
2. [ ] –ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ –∑—Ä–æ–∑—É–º—ñ–ª—É –ø–æ–º–∏–ª–∫—É —è–∫—â–æ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ
3. [ ] –î–æ–¥–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É :NvimAgentSetupCopilot –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
4. [ ] –ü–æ–∫—Ä–∞—â–∏—Ç–∏ –æ–±—Ä–æ–±–∫—É timeout –¥–ª—è tools
5. [ ] –î–æ–¥–∞—Ç–∏ –ø—Ä–æ–≥—Ä–µ—Å-–±–∞—Ä –¥–ª—è –¥–æ–≤–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π
